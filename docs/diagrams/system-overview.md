# üèóÔ∏è –û–±—â–∞—è —Å—Ö–µ–º–∞ —Å–∏—Å—Ç–µ–º—ã

–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ReportB24 - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bitrix24 –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Excel –æ—Ç—á—ë—Ç–æ–≤.

---

## üìä –û–±—â–∞—è —Å—Ö–µ–º–∞

```mermaid
graph TB
    subgraph "–í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã"
        Bitrix24[("üåê Bitrix24<br/>REST API")]
        User["üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"]
    end
    
    subgraph "ReportB24 Application"
        CLI["üñ•Ô∏è CLI Interface<br/>run_report.py"]
        API["üåê REST API<br/>(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"]
        
        subgraph "–Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
            App["üéØ ReportGeneratorApp<br/>–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞"]
            Config["‚öôÔ∏è ConfigReader<br/>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è"]
            Workflow["üîÑ WorkflowOrchestrator<br/>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è"]
        end
        
        subgraph "–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞"
            Client["üì° Bitrix24Client<br/>API –∫–ª–∏–µ–Ω—Ç"]
            Processor["‚öôÔ∏è DataProcessor<br/>–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö"]
            Generator["üìä ExcelGenerator<br/>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤"]
        end
        
        subgraph "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
            Cache["üíæ Cache<br/>–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ"]
            Logger["üìù Logger<br/>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ"]
            Validator["‚úÖ Validator<br/>–í–∞–ª–∏–¥–∞—Ü–∏—è"]
        end
    end
    
    subgraph "–•—Ä–∞–Ω–∏–ª–∏—â–µ"
        Excel[("üìÑ Excel —Ñ–∞–π–ª—ã<br/>reports/")]
        Logs[("üìã –õ–æ–≥–∏<br/>logs/")]
    end
    
    %% –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
    User -->|–ó–∞–ø—É—Å–∫| CLI
    User -->|HTTP| API
    
    CLI --> App
    API --> App
    
    App --> Config
    App --> Workflow
    
    Workflow --> Client
    Workflow --> Processor
    Workflow --> Generator
    
    Client <-->|REST API| Bitrix24
    Client --> Cache
    
    Processor --> Validator
    Generator --> Excel
    
    App --> Logger
    Logger --> Logs
    
    %% –°—Ç–∏–ª–∏
    classDef external fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    classDef core fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef business fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef infra fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef storage fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class Bitrix24,User external
    class App,Config,Workflow core
    class Client,Processor,Generator business
    class Cache,Logger,Validator infra
    class Excel,Logs storage
```

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **–¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-----------|-----------|---------------|
| **CLI** | –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ | –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫, —Å–∫—Ä–∏–ø—Ç—ã |
| **REST API** | HTTP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è |

### 2. **–Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-----------|-----------|-----------------|
| **ReportGeneratorApp** | –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è |
| **ConfigReader** | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ß—Ç–µ–Ω–∏–µ settings –∏–∑ config.ini –∏ .env |
| **WorkflowOrchestrator** | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |

### 3. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§—É–Ω–∫—Ü–∏–∏ |
|-----------|-----------|---------|
| **Bitrix24Client** | API –∫–ª–∏–µ–Ω—Ç | –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24 |
| **DataProcessor** | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –í–∞–ª–∏–¥–∞—Ü–∏—è, –æ–±–æ–≥–∞—â–µ–Ω–∏–µ, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **ExcelGenerator** | –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä | –°–æ–∑–¥–∞–Ω–∏–µ Excel —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º |

### 4. **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –†–æ–ª—å |
|-----------|-----------|------|
| **Cache** | –ö—ç—à | –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **Logger** | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –û—Ç–ª–∞–¥–∫–∞, –∞—É–¥–∏—Ç |
| **Validator** | –í–∞–ª–∏–¥–∞—Ü–∏—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö |

---

## üîÑ –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```mermaid
sequenceDiagram
    participant User
    participant App
    participant Client
    participant Bitrix24
    participant Processor
    participant Generator
    participant Excel

    User->>App: –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    App->>Client: get_smart_invoices()
    Client->>Bitrix24: REST API –∑–∞–ø—Ä–æ—Å
    Bitrix24-->>Client: JSON data
    Client-->>App: –°—á–µ—Ç–∞
    
    loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—á—ë—Ç–∞
        App->>Client: get_products_by_invoice()
        Client->>Bitrix24: REST API –∑–∞–ø—Ä–æ—Å
        Bitrix24-->>Client: –¢–æ–≤–∞—Ä—ã
        Client-->>App: –¢–æ–≤–∞—Ä—ã
        
        App->>Processor: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        Processor-->>App: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    end
    
    App->>Generator: generate_comprehensive_report()
    Generator->>Excel: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    Excel-->>Generator: Success
    Generator-->>App: Result
    App-->>User: ‚úÖ –û—Ç—á—ë—Ç –≥–æ—Ç–æ–≤
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –û–ø–µ—Ä–∞—Ü–∏—è | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è |
|----------|--------------|-------------|
| –ó–∞–≥—Ä—É–∑–∫–∞ 100 —Å—á–µ—Ç–æ–≤ | ~3 —Å–µ–∫ | Batch API |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö | ~1 —Å–µ–∫ | –í–∞–ª–∏–¥–∞—Ü–∏—è |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel | ~2 —Å–µ–∫ | openpyxl |
| **–ò—Ç–æ–≥–æ** | **~6 —Å–µ–∫** | v2.4.0+ |

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **Batch API** –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–æ 50x –±—ã—Å—Ç—Ä–µ–µ)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–æ–º–ø–∞–Ω–∏–π –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### üõ°Ô∏è –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry** –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
- **Rate limiting** (‚â§2 req/sec) –¥–ª—è Bitrix24 API
- **Graceful degradation** –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö
- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞** –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã

- **[Workflow](workflow.md)** - –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **[Data Flow](data-flow.md)** - –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É
- **[Architecture](architecture.md)** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

[‚Üê –ù–∞–∑–∞–¥ –∫ –¥–∏–∞–≥—Ä–∞–º–º–∞–º](index.md) | [Workflow ‚Üí](workflow.md)
