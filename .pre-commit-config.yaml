# üîí Pre-commit configuration –¥–ª—è ReportB24
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

repos:
  # –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
        name: üßπ –£–¥–∞–ª–µ–Ω–∏–µ trailing whitespace
      - id: end-of-file-fixer
        name: üìù –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
      - id: check-yaml
        name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ YAML —Ñ–∞–π–ª–æ–≤
      - id: check-json
        name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ JSON —Ñ–∞–π–ª–æ–≤
      - id: check-merge-conflict
        name: üîÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ merge conflicts
      - id: check-added-large-files
        name: üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
        args: ['--maxkb=1000']
      - id: detect-private-key
        name: üîë –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π

  # Python –∫–æ–¥
  - repo: https://github.com/psf/black
    rev: 23.3.0
    hooks:
      - id: black
        name: üñ§ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Python (Black)
        language_version: python3

  - repo: https://github.com/PyCQA/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
        name: üîç –õ–∏–Ω—Ç–∏–Ω–≥ Python (flake8)
        args: ['--max-line-length=88', '--extend-ignore=E203,W503']

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        name: üïµÔ∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
        args: ['--baseline', '.secrets.baseline']
        exclude: |
          (?x)(
            ^tests/.*test.*\.py$|
            ^.*\.example$|
            ^SECURITY_INCIDENT_REPORT\.md$
          )

  # –ö–∞—Å—Ç–æ–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - repo: local
    hooks:
      - id: security-check
        name: üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–µ–∫ webhook
        entry: python scripts/security_check.py
        language: python
        files: '\.(py|md|ini|yaml|yml|txt)$'
        pass_filenames: false
        always_run: true

      - id: memory-bank-security
        name: üß† –ü—Ä–æ–≤–µ—Ä–∫–∞ Memory Bank –Ω–∞ —É—Ç–µ—á–∫–∏
        entry: bash -c 'grep -r "https://[^/]*\.bitrix24\.[^/]*/rest/[^/]*/[^/\*]{5,}/" memory-bank/ && exit 1 || exit 0'
        language: system
        files: '^memory-bank/.*\.md$'
        pass_filenames: false

      - id: config-security
        name: ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        entry: bash -c 'find . -name "*.ini" -not -path "./.*" -exec grep -l "bitrix24\.ru/rest/.*/[a-zA-Z0-9_]\{10,\}/" {} \; | head -1 | grep -q . && exit 1 || exit 0'
        language: system
        files: '\.(ini|env)$'
        pass_filenames: false

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫
default_stages: [commit]
fail_fast: true

# Exclude patterns
exclude: |
  (?x)(
    /(\.[^/]*cache|__pycache__|node_modules)/|
    \.(log|tmp|temp)$|
    ^reports/|
    ^logs/|
    ^test_reports/
  )