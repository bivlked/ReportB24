"""
–ú–æ–¥—É–ª—å —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ UI.

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤.
"""

import sys
from typing import Optional


class Colors:
    """ANSI –∫–æ–¥—ã —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏."""

    # –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞
    RESET = "\033[0m"
    BOLD = "\033[1m"
    DIM = "\033[2m"

    # –¶–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞
    BLACK = "\033[30m"
    RED = "\033[31m"
    GREEN = "\033[32m"
    YELLOW = "\033[33m"
    BLUE = "\033[34m"
    MAGENTA = "\033[35m"
    CYAN = "\033[36m"
    WHITE = "\033[37m"

    # –Ø—Ä–∫–∏–µ —Ü–≤–µ—Ç–∞
    BRIGHT_RED = "\033[91m"
    BRIGHT_GREEN = "\033[92m"
    BRIGHT_YELLOW = "\033[93m"
    BRIGHT_BLUE = "\033[94m"
    BRIGHT_MAGENTA = "\033[95m"
    BRIGHT_CYAN = "\033[96m"

    # –§–æ–Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞
    BG_RED = "\033[41m"
    BG_GREEN = "\033[42m"
    BG_YELLOW = "\033[43m"
    BG_BLUE = "\033[44m"


class ConsoleUI:
    """–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å."""

    @staticmethod
    def print_header(text: str, color: str = Colors.BRIGHT_CYAN):
        """–ü–µ—á–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ä–∞–∑–¥–µ–ª–∞."""
        line = "‚ïê" * 60
        print(f"\n{color}{Colors.BOLD}{line}")
        print(f"  {text}")
        print(f"{line}{Colors.RESET}\n")

    @staticmethod
    def print_step(step_num: int, text: str, status: str = "‚è≥"):
        """–ü–µ—á–∞—Ç—å —à–∞–≥–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞."""
        print(
            f"{Colors.BRIGHT_BLUE}{Colors.BOLD}[{step_num}]{Colors.RESET} {status} {text}"
        )

    @staticmethod
    def print_success(text: str):
        """–ü–µ—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ."""
        print(f"{Colors.BRIGHT_GREEN}‚úÖ {text}{Colors.RESET}")

    @staticmethod
    def print_warning(text: str):
        """–ü–µ—á–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è."""
        print(f"{Colors.BRIGHT_YELLOW}‚ö†Ô∏è  {text}{Colors.RESET}")

    @staticmethod
    def print_error(text: str):
        """–ü–µ—á–∞—Ç—å –æ—à–∏–±–∫–∏."""
        print(f"{Colors.BRIGHT_RED}‚ùå {text}{Colors.RESET}")

    @staticmethod
    def print_info(text: str, indent: int = 0):
        """–ü–µ—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è."""
        spaces = "  " * indent
        print(f"{spaces}{Colors.CYAN}‚ÑπÔ∏è  {text}{Colors.RESET}")

    @staticmethod
    def print_progress(
        current: int,
        total: int,
        prefix: str = "",
        suffix: str = "",
        bar_length: int = 40,
    ):
        """
        –ü–µ—á–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞.

        Args:
            current: –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            total: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            prefix: –ü—Ä–µ—Ñ–∏–∫—Å –ø–µ—Ä–µ–¥ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
            suffix: –°—É—Ñ—Ñ–∏–∫—Å –ø–æ—Å–ª–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            bar_length: –î–ª–∏–Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö
        """
        if total == 0:
            return

        percent = int((current / total) * 100)
        filled_length = int(bar_length * current // total)
        bar = "‚ñà" * filled_length + "‚ñë" * (bar_length - filled_length)

        # –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        if percent < 50:
            color = Colors.RED
        elif percent < 80:
            color = Colors.YELLOW
        else:
            color = Colors.GREEN

        sys.stdout.write(f"\r{prefix} {color}|{bar}|{Colors.RESET} {percent}% {suffix}")
        sys.stdout.flush()

        if current == total:
            print()  # –ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –∫–æ–Ω—Ü–µ

    @staticmethod
    def print_stats_box(
        title: str,
        stats: dict,
        success_threshold: float = 90.0,
        warning_threshold: float = 70.0,
    ):
        """
        –ü–µ—á–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ä–∞–º–∫–µ.

        Args:
            title: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            stats: –°–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
            success_threshold: –ü–æ—Ä–æ–≥ —É—Å–ø–µ—Ö–∞ (%)
            warning_threshold: –ü–æ—Ä–æ–≥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (%)
        """
        print(f"\n{Colors.BRIGHT_CYAN}{Colors.BOLD}‚ïî{'‚ïê' * 58}‚ïó")
        print(f"‚ïë  {title:54}  ‚ïë")
        print(f"‚ï†{'‚ïê' * 58}‚ï£{Colors.RESET}")

        for key, value in stats.items():
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è
            color = Colors.RESET
            icon = "‚Ä¢"

            if isinstance(value, (int, float)):
                if value >= success_threshold:
                    color = Colors.BRIGHT_GREEN
                    icon = "‚úÖ"
                elif value >= warning_threshold:
                    color = Colors.BRIGHT_YELLOW
                    icon = "‚ö†Ô∏è"
                else:
                    color = Colors.BRIGHT_RED
                    icon = "‚ùå"

            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            if isinstance(value, float):
                value_str = f"{value:.1f}%"
            else:
                value_str = str(value)

            print(
                f"{Colors.CYAN}‚ïë{Colors.RESET}  {icon} {key:35} {color}{value_str:>15}{Colors.RESET} {Colors.CYAN}‚ïë{Colors.RESET}"
            )

        print(f"{Colors.BRIGHT_CYAN}‚ïö{'‚ïê' * 58}‚ïù{Colors.RESET}\n")

    @staticmethod
    def print_section_separator():
        """–ü–µ—á–∞—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏."""
        print(f"{Colors.DIM}{'‚îÄ' * 60}{Colors.RESET}")

    @staticmethod
    def print_completion_banner(output_path: str):
        """–ü–µ—á–∞—Ç—å –±–∞–Ω–Ω–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è."""
        print(f"\n{Colors.BRIGHT_GREEN}{Colors.BOLD}")
        print("‚ïî" + "‚ïê" * 58 + "‚ïó")
        print("‚ïë" + " " * 58 + "‚ïë")
        print("‚ïë" + "  üéâ –û–¢–ß–Å–¢ –£–°–ü–ï–®–ù–û –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù!".center(58) + "‚ïë")
        print("‚ïë" + " " * 58 + "‚ïë")
        print("‚ïö" + "‚ïê" * 58 + "‚ïù")
        print(Colors.RESET)
        print(
            f"{Colors.CYAN}üìÑ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {Colors.WHITE}{output_path}{Colors.RESET}\n"
        )


def format_number(num: int) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–ª–∞ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á."""
    return f"{num:,}".replace(",", " ")


def format_duration(seconds: float) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥.

    Args:
        seconds: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
    """
    if seconds < 1:
        return f"{seconds * 1000:.0f}–º—Å"
    elif seconds < 60:
        return f"{seconds:.1f}—Å"
    else:
        minutes = int(seconds // 60)
        secs = seconds % 60
        return f"{minutes}–º {secs:.0f}—Å"
