# üìò –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ ReportB24

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ReportB24. –ó–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω—ã –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É –æ—Ç—á—ë—Ç–æ–≤, –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–µ—Ä–∏–æ–¥–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

<a id="–±—ã—Å—Ç—Ä—ã–π-–æ–±–∑–æ—Ä"></a>
## üöÄ –ë—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä

1. –°–ª–µ–¥—É–π—Ç–µ —Ä–∞–∑–¥–µ–ª—É ¬´–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Windows)¬ª –≤ [README](../README.md) –¥–ª—è –±–∞–∑–æ–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏.
2. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ `config.ini` –∏ `.env`, —É–∫–∞–∑–∞–≤ —Ä–∞–±–æ—á–∏–π –ø–µ—Ä–∏–æ–¥ –∏ webhook Bitrix24.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `py run_report.py`, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–≤—É—Ö–ª–∏—Å—Ç–æ–≤–æ–π –æ—Ç—á—ë—Ç –≤ –ø–∞–ø–∫–µ `reports/`.
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.

<a id="—Ä–∞–±–æ—Ç–∞-—Å-—Ñ–∏–ª—å—Ç—Ä–∞–º–∏-–∏-–ø–µ—Ä–∏–æ–¥–∞–º–∏"></a>
## üß≠ –†–∞–±–æ—Ç–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–∏–æ–¥–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- `config.ini` ‚Üí —Å–µ–∫—Ü–∏—è `[ReportPeriod]` —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –¥–∞—Ç.
- –§–æ—Ä–º–∞—Ç –¥–∞—Ç: `–¥–¥.–º–º.–≥–≥–≥–≥`.
- –ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `run_report.py` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞

```python
from datetime import datetime, timedelta
from src.core.app import AppFactory

with AppFactory.create_app('config.ini') as app:
    if not app.initialize():
        raise SystemExit('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞')

    end_date = datetime.now()
    start_date = end_date - timedelta(days=90)

    app.set_report_period(
        start_date.strftime('%d.%m.%Y'),
        end_date.strftime('%d.%m.%Y')
    )

    app.generate_report('reports/–æ—Ç—á—ë—Ç_–ø–æ—Å–ª–µ–¥–Ω–∏–µ_90_–¥–Ω–µ–π.xlsx')
```

### –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É (–ò–ù–ù)

```python
from src.core.app import AppFactory

with AppFactory.create_app('config.ini') as app:
    if app.initialize():
        app.set_contractor_filter(inn='7701234567')
        app.generate_report('reports/–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç_7701234567.xlsx')
```

### –ß–∞—Å—Ç–∏—á–Ω–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –ø–æ –Ω–æ–º–µ—Ä–∞–º —Å—á–µ—Ç–æ–≤

```python
from src.core.app import AppFactory

invoice_numbers = ['–°–ß–ï–¢-001', '–°–ß–ï–¢-025']

with AppFactory.create_app('config.ini') as app:
    if app.initialize():
        app.set_invoice_filter(numbers=invoice_numbers)
        app.generate_report('reports/—Å—á–µ—Ç–∞_001_025.xlsx')
```

<a id="–ø–æ–≤—Ç–æ—Ä–Ω—ã–π-–∑–∞–ø—É—Å–∫-–∏-—Ä–æ—Ç–∞—Ü–∏—è-—Ñ–∞–π–ª–æ–≤"></a>
## üîÑ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏ —Ä–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

- –ò–∑–º–µ–Ω–∏—Ç–µ `defaultfilename` –≤ `config.ini`, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–π —Ñ–∞–π–ª.
- –í–∫–ª—é—á–∏—Ç–µ —Ç–∞–π–º—Å—Ç–µ–º–ø—ã –≤ –∏–º–µ–Ω–∏ –ø—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º –∑–∞–ø—É—Å–∫–µ: `f"reports/–æ—Ç—á—ë—Ç_{datetime.now():%Y%m%d_%H%M}.xlsx"`.
- –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ PowerShell: `Get-ChildItem reports -File -OlderThan 30d | Remove-Item`.

<a id="–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è-–∏-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏"></a>
## ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏

### Windows Task Scheduler

1. –û—Ç–∫—Ä–æ–π—Ç–µ ¬´–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞–Ω–∏–π¬ª ‚Üí ¬´–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É¬ª.
2. –£–∫–∞–∂–∏—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤ 07:00).
3. –í –¥–µ–π—Å—Ç–≤–∏—è—Ö –¥–æ–±–∞–≤—å—Ç–µ: `Program/script: py`, `Add arguments: run_report.py`, `Start in: C:\Projects\ReportB24`.
4. –í–∫–ª—é—á–∏—Ç–µ ¬´–ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ç–∏¬ª, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–±–æ–µ–≤ Bitrix24.

### GitHub Actions (self-hosted)

```yaml
name: Nightly Report
on:
  schedule:
    - cron: '0 3 * * *'

jobs:
  build:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -r requirements.txt
      - name: Generate report
        env:
          BITRIX_WEBHOOK_URL: ${{ secrets.BITRIX_WEBHOOK_URL }}
        run: python run_report.py
```

### Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```Dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY . .
RUN pip install --no-cache-dir -r requirements.txt
CMD ["python", "run_report.py"]
```

<a id="–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"></a>
## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

- –§–∞–π–ª –æ—Ç—á—ë—Ç–∞: `reports/<–∏–º—è –∏–∑ config.ini>`.
- –õ–æ–≥–∏: `logs/app.log` (–∏—Å–∫–æ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: `‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞`, `‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Bitrix24 —É—Å–ø–µ—à–Ω–æ`).
- –ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `0` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞.

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è?**  
–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `defaultsavefolder` –≤ `config.ini` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

**–ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å macOS –∏–ª–∏ Linux?**  
–î–∞. –°–æ–∑–¥–∞–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π `python3 -m venv .venv` –∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ `python3 run_report.py`.

**–ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏?**  
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `loglevel = DEBUG` –≤ —Å–µ–∫—Ü–∏–∏ `[AppSettings]` —Ñ–∞–π–ª–∞ `config.ini`.

