# üîå Bitrix24Client API Reference

**–ú–æ–¥—É–ª—å**: `src.bitrix24_client.client`  
**–ö–ª–∞—Å—Å**: `Bitrix24Client`  
**–í–µ—Ä—Å–∏—è**: v3.0.2

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è](#–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
- [–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–º–µ—Ç–æ–¥—ã)
- [–†–∞–±–æ—Ç–∞ —Å–æ —Å—á–µ—Ç–∞–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å–æ-—Å—á–µ—Ç–∞–º–∏)
- [–†–∞–±–æ—Ç–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-—Ç–æ–≤–∞—Ä–∞–º–∏)
- [–†–∞–±–æ—Ç–∞ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-–∫–æ–º–ø–∞–Ω–∏—è–º–∏)
- [–°–ª—É–∂–µ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã](#—Å–ª—É–∂–µ–±–Ω—ã–µ-–º–µ—Ç–æ–¥—ã)
- [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
- [Best Practices](#best-practices)

---

## üìñ –û–±–∑–æ—Ä

`Bitrix24Client` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Bitrix24 REST API. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–º–Ω—ã–º–∏ —Å—á–µ—Ç–∞–º–∏ (Smart Invoices), —Ç–æ–≤–∞—Ä–∞–º–∏, –∫–æ–º–ø–∞–Ω–∏—è–º–∏ –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚ö° **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rate limiting** (‚â§2 req/sec)
- üîÑ **Retry –º–µ—Ö–∞–Ω–∏–∑–º** –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
- üíæ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- üõ°Ô∏è **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API
- üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —Å –º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π webhook URL

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```python
from src.bitrix24_client.client import Bitrix24Client

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
client = Bitrix24Client(
    webhook_url="https://your-portal.bitrix24.ru/rest/12/your-key/",
    timeout=30,
    max_retries=3,
    rate_limit=2.0
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ —É–º–Ω—ã—Ö —Å—á–µ—Ç–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
invoices = client.get_smart_invoices(
    start_date="2024-01-01",
    end_date="2024-01-31"
)

print(f"–ü–æ–ª—É—á–µ–Ω–æ —Å—á–µ—Ç–æ–≤: {len(invoices)}")

# –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
client.close()
```

> üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ context manager –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

---

## üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

### `__init__(webhook_url, timeout, max_retries, rate_limit)`

–°–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∏–µ–Ω—Ç–∞ Bitrix24.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `webhook_url` | `str` | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π* | URL webhook –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API |
| `timeout` | `int` | `30` | –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö |
| `max_retries` | `int` | `3` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ |
| `rate_limit` | `float` | `2.0` | –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Bitrix24Client`

**–ü—Ä–∏–º–µ—Ä:**

```python
# –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
client = Bitrix24Client(
    webhook_url="https://portal.bitrix24.ru/rest/12/abc123/"
)

# –° –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
client = Bitrix24Client(
    webhook_url="https://portal.bitrix24.ru/rest/12/abc123/",
    timeout=60,        # –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç
    max_retries=5,     # –ë–æ–ª—å—à–µ –ø–æ–ø—ã—Ç–æ–∫
    rate_limit=1.5     # –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
)
```

**–í–∞–∂–Ω–æ:**
- ‚ö†Ô∏è Webhook URL –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å trailing slash `/`
- üîí URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- üìä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è AdaptiveRateLimiter –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

### `get_smart_invoices(start_date, end_date, filter_params=None)`

–ü–æ–ª—É—á–∞–µ—Ç —É–º–Ω—ã–µ —Å—á–µ—Ç–∞ (Smart Invoices) –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥. –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—á–µ—Ç–∞–º–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `start_date` | `str` | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞ (YYYY-MM-DD) |
| `end_date` | `str` | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ (YYYY-MM-DD) |
| `filter_params` | `dict`, optional | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `List[Dict[str, Any]]` - —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä:**

```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç–æ–≤ –∑–∞ –º–µ—Å—è—Ü
invoices = client.get_smart_invoices(
    start_date="2024-01-01",
    end_date="2024-01-31"
)

for invoice in invoices:
    print(f"–°—á—ë—Ç {invoice['accountNumber']}: {invoice['opportunity']} —Ä—É–±.")

# –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
invoices = client.get_smart_invoices(
    start_date="2024-01-01",
    end_date="2024-01-31",
    filter_params={">=OPPORTUNITY": 10000}  # –¢–æ–ª—å–∫–æ —Å—á–µ—Ç–∞ ‚â• 10000 —Ä—É–±
)
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```python
{
    "id": "12345",
    "accountNumber": "–°-00123",
    "opportunity": "50000.00",
    "ufCrm_..._TITLE": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å—á—ë—Ç–∞",
    "begindate": "2024-01-15T00:00:00+03:00",
    # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- ‚ö° –ò—Å–ø–æ–ª—å–∑—É–µ—Ç batch API –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- üíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö

---

### `call(method, params=None)`

–ë–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã–∑–æ–≤–∞ –ª—é–±–æ–≥–æ –º–µ—Ç–æ–¥–∞ Bitrix24 API.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `method` | `str` | –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, "crm.deal.list") |
| `params` | `dict`, optional | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Dict[str, Any]` - –æ—Ç–≤–µ—Ç –æ—Ç API

**–ü—Ä–∏–º–µ—Ä:**

```python
# –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ API –º–µ—Ç–æ–¥–∞
response = client.call(
    method="crm.deal.list",
    params={
        "filter": {"STAGE_ID": "WON"},
        "select": ["ID", "TITLE", "OPPORTUNITY"]
    }
)

deals = response.get("result", [])
print(f"–ù–∞–π–¥–µ–Ω–æ —Å–¥–µ–ª–æ–∫: {len(deals)}")

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
user_info = client.call("user.current")
print(f"–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_info['result']['NAME']}")
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

```python
from src.bitrix24_client.exceptions import Bitrix24APIError

try:
    result = client.call("crm.deal.get", {"ID": "999999"})
except Bitrix24APIError as e:
    print(f"–û—à–∏–±–∫–∞ API: {e}")
```

---

## üìÑ –†–∞–±–æ—Ç–∞ —Å–æ —Å—á–µ—Ç–∞–º–∏

### `get_detailed_invoice_data(invoice_id)`

–ü–æ–ª—É—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—á—ë—Ç–µ, –≤–∫–ª—é—á–∞—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `invoice_id` | `int` | ID —Å—á—ë—Ç–∞ |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Optional[Dict[str, Any]]` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—á—ë—Ç–∞ –∏–ª–∏ `None`

**–ü—Ä–∏–º–µ—Ä:**

```python
invoice_data = client.get_detailed_invoice_data(invoice_id=12345)

if invoice_data:
    print(f"–ù–æ–º–µ—Ä: {invoice_data['accountNumber']}")
    print(f"–°—É–º–º–∞: {invoice_data['opportunity']}")
    print(f"–¢–æ–≤–∞—Ä–æ–≤: {len(invoice_data.get('products', []))}")
else:
    print("–°—á—ë—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
```

---

### `get_all_invoices(start_date, end_date)`

–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å—á–µ—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π API).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `start_date` | `str` | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ (YYYY-MM-DD) |
| `end_date` | `str` | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (YYYY-MM-DD) |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `List[Dict[str, Any]]`

**–ü—Ä–∏–º–µ—Ä:**

```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤ (legacy API)
invoices = client.get_all_invoices(
    start_date="2024-01-01",
    end_date="2024-01-31"
)
```

> ‚ö†Ô∏è **Deprecated**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_smart_invoices()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º API

---

## üì¶ –†–∞–±–æ—Ç–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏

### `get_products_by_invoice(invoice_id)`

–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ ID —Å—á—ë—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `invoice_id` | `int` | ID —Å—á—ë—Ç–∞ |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Dict[str, Any]` - —Å–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–∞–º–∏ `products`, `has_error`, `error_message`

**–ü—Ä–∏–º–µ—Ä:**

```python
result = client.get_products_by_invoice(invoice_id=12345)

if result["has_error"]:
    print(f"–û—à–∏–±–∫–∞: {result['error_message']}")
else:
    products = result["products"]
    print(f"–¢–æ–≤–∞—Ä–æ–≤: {len(products)}")
    
    for product in products:
        print(f"- {product['PRODUCT_NAME']}: {product['PRICE']} x {product['QUANTITY']}")
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:**

```python
{
    "products": [
        {
            "PRODUCT_ID": "123",
            "PRODUCT_NAME": "–¢–æ–≤–∞—Ä 1",
            "PRICE": "1000.00",
            "QUANTITY": "2",
            "TAX_RATE": "20",
            # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
        }
    ],
    "has_error": False,
    "error_message": None
}
```

---

### `get_products_by_invoices_batch(invoice_ids)`

–ü–∞–∫–µ—Ç–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å—á–µ—Ç–æ–≤ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `invoice_ids` | `List[int]` | –°–ø–∏—Å–æ–∫ ID —Å—á–µ—Ç–æ–≤ |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Dict[int, List[Dict]]` - —Å–ª–æ–≤–∞—Ä—å {invoice_id: [products]}

**–ü—Ä–∏–º–µ—Ä:**

```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—á–µ—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
invoice_ids = [12345, 12346, 12347, 12348, 12349]
products_by_invoice = client.get_products_by_invoices_batch(invoice_ids)

for invoice_id, products in products_by_invoice.items():
    print(f"–°—á—ë—Ç {invoice_id}: {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –î–æ 50x –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç batch API
- üíæ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤

---

## üè¢ –†–∞–±–æ—Ç–∞ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏

### `get_company_info_by_invoice(invoice_number)`

–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –ò–ù–ù) –ø–æ –Ω–æ–º–µ—Ä—É —Å—á—ë—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `invoice_number` | `str` | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°-00123") |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Tuple[str, str]` - (–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏, –ò–ù–ù)

**–ü—Ä–∏–º–µ—Ä:**

```python
company_name, inn = client.get_company_info_by_invoice("–°-00123")

if company_name != "–ù–µ —É–∫–∞–∑–∞–Ω–æ":
    print(f"–ö–æ–º–ø–∞–Ω–∏—è: {company_name}")
    print(f"–ò–ù–ù: {inn}")
else:
    print("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `("–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏", "1234567890")` - —É—Å–ø–µ—à–Ω–æ
- `("–ù–µ —É–∫–∞–∑–∞–Ω–æ", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")` - –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
- `("–û—à–∏–±–∫–∞", "–û—à–∏–±–∫–∞")` - –æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞

---

## üõ†Ô∏è –°–ª—É–∂–µ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã

### `get_stats()`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API –∫–ª–∏–µ–Ω—Ç–∞.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Dict[str, Any]` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ü—Ä–∏–º–µ—Ä:**

```python
stats = client.get_stats()

print(f"–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: {stats['total_requests']}")
print(f"–£—Å–ø–µ—à–Ω—ã—Ö: {stats['successful_requests']}")
print(f"–û—à–∏–±–æ–∫: {stats['failed_requests']}")
print(f"–ü–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à: {stats['cache_hits']}")
print(f"–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: {stats['uptime_seconds']}—Å")
```

---

### `close()`

–ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.

**–ü—Ä–∏–º–µ—Ä:**

```python
client = Bitrix24Client(webhook_url="...")
try:
    invoices = client.get_smart_invoices("2024-01-01", "2024-01-31")
    # ... —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
finally:
    client.close()
```

> üí° **Best Practice**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ context manager –≤–º–µ—Å—Ç–æ —è–≤–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `close()`

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π

```python
from src.bitrix24_client.exceptions import (
    Bitrix24APIError,      # –ë–∞–∑–æ–≤–∞—è –æ—à–∏–±–∫–∞ API
    RateLimitError,        # –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
    ServerError,           # –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (5xx)
    AuthenticationError,   # –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    NetworkError,          # –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞
    BadRequestError,       # –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å (4xx)
    NotFoundError,         # –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
    TimeoutError           # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞
)
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
try:
    invoices = client.get_smart_invoices("2024-01-01", "2024-01-31")
    
except RateLimitError as e:
    print(f"–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤: {e}")
    # –ü–æ–¥–æ–∂–¥–∏—Ç–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É
    
except AuthenticationError as e:
    print(f"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: {e}")
    # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook URL
    
except NetworkError as e:
    print(f"–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: {e}")
    # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    
except Bitrix24APIError as e:
    print(f"–û–±—â–∞—è –æ—à–∏–±–∫–∞ API: {e}")
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫
```

---

## üéØ Best Practices

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Context Manager

```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
with Bitrix24Client(webhook_url="...") as client:
    invoices = client.get_smart_invoices("2024-01-01", "2024-01-31")
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
client = Bitrix24Client(webhook_url="...")
invoices = client.get_smart_invoices("2024-01-01", "2024-01-31")
# –ó–∞–±—ã–ª–∏ –≤—ã–∑–≤–∞—Ç—å close()
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Batch API –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤

```python
# ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ - –æ–¥–∏–Ω batch –∑–∞–ø—Ä–æ—Å
products = client.get_products_by_invoices_batch([1, 2, 3, 4, 5])

# ‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ - 5 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
for invoice_id in [1, 2, 3, 4, 5]:
    products = client.get_products_by_invoice(invoice_id)
```

### 3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

```python
result = client.get_products_by_invoice(invoice_id)

if result["has_error"]:
    logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –¥–ª—è —Å—á—ë—Ç–∞ {invoice_id}")
    # –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö —Å—á–µ—Ç–æ–≤
else:
    products = result["products"]
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—ã
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```python
# –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
stats = client.get_stats()
if stats['failed_requests'] / stats['total_requests'] > 0.1:
    logger.warning("–í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ API!")
```

### 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ rate limiting

```python
# –î–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º —É–º–µ–Ω—å—à–∏—Ç–µ rate
client = Bitrix24Client(
    webhook_url="...",
    rate_limit=1.5  # 1.5 –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥—É
)

# –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å
client = Bitrix24Client(
    webhook_url="...",
    rate_limit=3.0  # –û—Å—Ç–æ—Ä–æ–∂–Ω–æ! –ú–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã Bitrix24
)
```

---

## üìö –°–º. —Ç–∞–∫–∂–µ

- [DataProcessor API](data-processor.md) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
- [WorkflowOrchestrator API](workflow.md) - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](../../examples/) - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ**: 2025-11-01  
**–í–µ—Ä—Å–∏—è API**: v3.0.2
