# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ ReportB24

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
- [SOLID –ü—Ä–∏–Ω—Ü–∏–ø—ã](#solid-–ø—Ä–∏–Ω—Ü–∏–ø—ã)
- [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
- [–î–∏–∞–≥—Ä–∞–º–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è](#–¥–∏–∞–≥—Ä–∞–º–º–∞-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
- [Patterns –∏ Best Practices](#patterns-–∏-best-practices)

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ü—Ä–æ–µ–∫—Ç ReportB24 –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π (Separation of Concerns). –°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –ø—è—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–ª–æ–µ–≤:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   APPLICATION LAYER                     ‚îÇ
‚îÇ                (ReportGeneratorApp)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ORCHESTRATION   ‚îÇ   ‚îÇ  CONFIGURATION    ‚îÇ
‚îÇ  WorkflowOrchest ‚îÇ   ‚îÇ  ConfigReader     ‚îÇ
‚îÇ  rator           ‚îÇ   ‚îÇ  Settings         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ         ‚îÇ          ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇBitrix ‚îÇ ‚îÇData  ‚îÇ ‚îÇExcel   ‚îÇ ‚îÇError  ‚îÇ
‚îÇClient ‚îÇ ‚îÇProc  ‚îÇ ‚îÇGen     ‚îÇ ‚îÇHandle ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## SOLID –ü—Ä–∏–Ω—Ü–∏–ø—ã

### 1Ô∏è‚É£ Single Responsibility Principle (SRP)

–ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç –æ–¥–Ω—É, —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-----------|----------------|
| `ReportGeneratorApp` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `WorkflowOrchestrator` | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞ |
| `Bitrix24Client` | –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å Bitrix24 API |
| `DataProcessor` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö |
| `ExcelReportGenerator` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel –æ—Ç—á–µ—Ç–æ–≤ |
| `ConfigReader` | –ß—Ç–µ–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |

**–ü—Ä–∏–º–µ—Ä —Å–æ–±–ª—é–¥–µ–Ω–∏—è SRP:**
```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –¥–µ–ª–∞–µ—Ç –æ–¥–Ω—É –≤–µ—â—å
class DataProcessor:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å—á–µ—Ç–æ–≤."""
    
class ExcelReportGenerator:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Excel –æ—Ç—á–µ—Ç—ã."""
    
# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: –û–¥–∏–Ω –∫–ª–∞—Å—Å –¥–µ–ª–∞–µ—Ç –≤—Å–µ
class ReportProcessor:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ò –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Excel."""  # –ù–∞—Ä—É—à–µ–Ω–∏–µ SRP
```

### 2Ô∏è‚É£ Open/Closed Principle (OCP)

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:

- **–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö** (`DataProcessor`, `CurrencyProcessor`, `INNProcessor`, `DateProcessor`) - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
- **–§–æ—Ä–º–∞—Ç–µ—Ä—ã Excel** - –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏ —Ñ–æ—Ä–º–∞—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫** - —Ä–∞—Å—à–∏—Ä—è–µ–º—ã —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤

**–ü—Ä–∏–º–µ—Ä:**
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è DataProcessor
class VATProcessor:
    """–ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –ù–î–°."""
    
# DataProcessor –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–∑–∏—Ü–∏—é
data_processor.vat_processor = VATProcessor()  # –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
```

### 3Ô∏è‚É£ Liskov Substitution Principle (LSP)

–ü–æ–¥–∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã:

- `ConfigReader` –∏ `SecureConfigReader` –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `ProcessedInvoice` –∏ `InvoiceData` - —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —Å —á–µ—Ç–∫–∏–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º

**–ü—Ä–∏–º–µ—Ä:**
```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –û–±–∞ —á–∏—Ç–∞—é—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–¥–∏–Ω–∞–∫–æ–≤–æ
config_reader: ConfigReader = ConfigReader(path)
# –∏–ª–∏
config_reader: ConfigReader = SecureConfigReader(path)

# –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±–æ–∏–º–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ
bitrix_config = config_reader.get_bitrix24_config()
```

### 4Ô∏è‚É£ Interface Segregation Principle (ISP)

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –º–∞–ª–µ–Ω—å–∫–∏–µ –∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ:

- `CurrencyProcessor` - —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∞–ª—é—Ç
- `INNProcessor` - —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù
- `DateProcessor` - —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏

**–ü—Ä–∏–º–µ—Ä:**
```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
class INNProcessor:
    def validate_inn(self, inn: str) -> INNValidationResult: ...
    def format_inn(self, inn: str) -> str: ...

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: –°–ª–∏—à–∫–æ–º –æ–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
class UniversalProcessor:
    def validate_inn(self, inn: str): ...
    def parse_date(self, date: str): ...  # –ù–µ —Å–≤—è–∑–∞–Ω–æ —Å –ò–ù–ù!
    def format_currency(self, amount: float): ...  # –ù–µ —Å–≤—è–∑–∞–Ω–æ —Å –ò–ù–ù!
```

### 5Ô∏è‚É£ Dependency Inversion Principle (DIP)

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π, –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π:

- `WorkflowOrchestrator` –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (Dependency Injection)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç —Å–≤–æ–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –æ–Ω–∏ –∏–Ω–∂–µ–∫—Ç—è—Ç—Å—è

**–ü—Ä–∏–º–µ—Ä:**
```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: Dependency Injection
class WorkflowOrchestrator:
    def __init__(self, config_reader: ConfigReader, bitrix_client: Bitrix24Client):
        self.config_reader = config_reader  # –ò–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è
        self.bitrix_client = bitrix_client  # –ò–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ñ–µ—Å—Ç–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
class BadWorkflow:
    def __init__(self):
        self.client = Bitrix24Client()  # –°–æ–∑–¥–∞–µ—Ç —Å–∞–º = –∂–µ—Å—Ç–∫–∞—è —Å–≤—è–∑—å
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### üéØ Core Layer

#### `ReportGeneratorApp`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `initialize()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- `generate_report()` - –∑–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞
- `_setup_logging()` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–æ—Ç–∞—Ü–∏–µ–π

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** ConfigReader, Bitrix24Client, DataProcessor, ExcelReportGenerator, WorkflowOrchestrator

#### `WorkflowOrchestrator`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è workflow –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `execute_full_workflow()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ (v2.4.0 - refactored)
- `_fetch_invoices_data()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24
- `_enrich_invoices_with_requisites()` - –æ–±–æ–≥–∞—â–µ–Ω–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏ (v2.4.0 - optimized)

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ v2.4.0:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ (50-90% –º–µ–Ω—å—à–µ API –∑–∞–ø—Ä–æ—Å–æ–≤)
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ 6 helper –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —ç—Ç–∞–ø–æ–≤ workflow

### üìä Data Processing Layer

#### `DataProcessor`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `process_invoice_batch()` - batch-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—á–µ—Ç–æ–≤ (v2.4.0)
- `format_product_data()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ (v2.4.0 - refactored 125‚Üí45 lines)
- `_extract_invoice_number()` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ (v2.4.0 - optimized with generators)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** CurrencyProcessor, INNProcessor, DateProcessor

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ v2.4.0:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `next()` –∏ generators –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–∞–º (10-15% –±—ã—Å—Ç—Ä–µ–µ)
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–ª–æ–∂–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –Ω–∞ helper –º–µ—Ç–æ–¥—ã

#### `CurrencyProcessor`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∞–ª—é—Ç –∏ —Å—É–º–º

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `parse_amount()` - –ø–∞—Ä—Å–∏–Ω–≥ —Å—É–º–º —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏
- `calculate_vat()` - —Ä–∞—Å—á–µ—Ç –ù–î–°
- `format_amount()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç

#### `INNProcessor`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `validate_inn()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º–µ
- `format_inn()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ò–ù–ù

#### `DateProcessor`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `parse_date()` - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- `format_date()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç

### üåê API Layer

#### `Bitrix24Client`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å Bitrix24 API

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `get_smart_invoices()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç–æ–≤
- `get_company_info_by_invoice()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** RateLimiter, RetryDecorator, ApiCache

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Rate limiting –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ API
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### üìÑ Excel Generation Layer

#### `ExcelReportGenerator`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel –æ—Ç—á–µ—Ç–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `generate_report()` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
- `_create_sheet()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Å—Ç–∞
- `_format_cells()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —è—á–µ–µ–∫

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** ExcelFormatter, ExcelLayoutManager, ExcelStyles

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ v2.4.0:**
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `Decimal` —Ç–∏–ø–∞–º–∏ –∏–∑ `ProcessedInvoice`
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ Excel

### ‚öôÔ∏è Configuration Layer

#### `ConfigReader`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .ini —Ñ–∞–π–ª–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `get_bitrix24_config()` - –ø–æ–ª—É—á–µ–Ω–∏–µ Bitrix24 –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `get_report_period_config()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –æ—Ç—á–µ—Ç–∞
- `get_app_config()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### `SecureConfigReader`
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–æ–π

**–ù–∞—Å–ª–µ–¥—É–µ—Ç:** ConfigReader (LSP - –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º)

---

## –î–∏–∞–≥—Ä–∞–º–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞

```mermaid
sequenceDiagram
    participant User
    participant App as ReportGeneratorApp
    participant Workflow as WorkflowOrchestrator
    participant Bitrix as Bitrix24Client
    participant DataProc as DataProcessor
    participant Excel as ExcelReportGenerator

    User->>App: generate_report()
    App->>Workflow: execute_full_workflow()
    
    Note over Workflow: –≠—Ç–∞–ø 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    Workflow->>Workflow: get_report_period_config()
    
    Note over Workflow: –≠—Ç–∞–ø 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    Workflow->>Bitrix: get_smart_invoices()
    Bitrix-->>Workflow: raw_invoices
    
    Note over Workflow: –≠—Ç–∞–ø 2.5: –û–±–æ–≥–∞—â–µ–Ω–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏ (v2.4.0 optimized)
    Workflow->>Workflow: _enrich_invoices_with_requisites()
    loop –î–ª—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
        Workflow->>Bitrix: get_company_info_by_invoice()
        Bitrix-->>Workflow: company_info
    end
    
    Note over Workflow: –≠—Ç–∞–ø 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    Workflow->>DataProc: process_invoice_batch()
    DataProc->>DataProc: –í–∞–ª–∏–¥–∞—Ü–∏—è, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    DataProc-->>Workflow: processed_data (ProcessedInvoice[])
    
    Note over Workflow: –≠—Ç–∞–ø 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel
    Workflow->>Excel: generate_report(processed_data)
    Excel->>Excel: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Decimal —Ç–∏–ø–æ–≤
    Excel-->>Workflow: excel_path
    
    Note over Workflow: –≠—Ç–∞–ø 5: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
    Workflow-->>App: WorkflowResult
    App-->>User: success / error
```

---

## Patterns –∏ Best Practices

### ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

#### 1. **Facade Pattern**
`ReportGeneratorApp` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–ª–æ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

#### 2. **Strategy Pattern**
`ConfigReader` vs `SecureConfigReader` - —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —á—Ç–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

#### 3. **Template Method Pattern**
`WorkflowOrchestrator.execute_full_workflow()` - —à–∞–±–ª–æ–Ω –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —ç—Ç–∞–ø–∞–º–∏.

#### 4. **Dependency Injection**
–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

#### 5. **Data Transfer Object (DTO)**
`InvoiceData`, `ProcessedInvoice`, `WorkflowResult` - —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö.

### üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ v2.4.0

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤** (50-90% —É–ª—É—á—à–µ–Ω–∏–µ)
   ```python
   # –ë—ã–ª–æ: N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è N —Å—á–µ—Ç–æ–≤
   for invoice in invoices:
       get_company_info(invoice.account_number)
   
   # –°—Ç–∞–ª–æ: K –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è K —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
   unique_accounts = set(inv.account_number for inv in invoices)
   for account in unique_accounts:
       cache[account] = get_company_info(account)
   ```

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–∞–º** (10-15% –±—ã—Å—Ç—Ä–µ–µ)
   ```python
   # –ë—ã–ª–æ: –¶–∏–∫–ª —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
   for key in possible_keys:
       if key in data and data[key]:
           return data[key]
   
   # –°—Ç–∞–ª–æ: Generator expression
   return next((data[key] for key in possible_keys if key in data and data[key]), None)
   ```

3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–ª–æ–∂–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤** (60-70% —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞)
   - `format_product_data`: 125 ‚Üí 45 —Å—Ç—Ä–æ–∫
   - `_fetch_invoices_data`: 99 ‚Üí 30 —Å—Ç—Ä–æ–∫
   - `execute_full_workflow`: 97 ‚Üí 40 —Å—Ç—Ä–æ–∫

#### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

1. **–£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞** - 21 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤
2. **Decimal —Ç–∏–ø—ã** - –∑–∞–º–µ–Ω–∞ `float` –Ω–∞ `Decimal` –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤
3. **Type hints** - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –ª—É—á—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ IDE
4. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º 30 –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏

---

## üîÑ Lifecycle –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
Initialization ‚Üí Configuration ‚Üí Validation ‚Üí Execution ‚Üí Finalization
       ‚Üì              ‚Üì              ‚Üì            ‚Üì            ‚Üì
   App Start    Load Config    Check System   Run Workflow   Cleanup
       ‚îÇ              ‚îÇ              ‚îÇ            ‚îÇ            ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         Error Handling & Logging
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:

1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç –æ–¥–Ω—É —á–µ—Ç–∫—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å (SRP)
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ DI** - –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
3. **–°–ª–µ–¥—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º** - —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. **–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–µ—Å—Ç—ã** - –º–∏–Ω–∏–º—É–º unit —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –æ–±–Ω–æ–≤–ª—è–π—Ç–µ ARCHITECTURE.md –∏ docstrings

### –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ:

1. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –Ω–µ –ª–æ–º–∞–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π API
2. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ—Å—Ç—å** - –±–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ–ª–∞–π—Ç–µ –ø–æ—ç—Ç–∞–ø–Ω–æ
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. **–ò–∑–º–µ—Ä—è–π—Ç–µ** - –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–∑–º–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** v2.4.0  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-10-26  
**–ê–≤—Ç–æ—Ä:** ReportB24 Development Team
